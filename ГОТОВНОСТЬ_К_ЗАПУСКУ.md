# Готовность к реальному запуску

Кратко: **для продакшена ещё не всё готово.** Ниже — что уже есть и что нужно доделать.

---

## ✅ Уже готово

| Компонент | Статус |
|-----------|--------|
| **Бэкенд (NestJS)** | API реализован: авторизация Telegram, JWT, профили, заявки, склады, карта |
| **БД (Prisma)** | Схема готова: users, clients, drivers, orders, warehouses, audit |
| **Фронтенд** | Экраны и интеграция с API, Telegram WebApp, сборка Vite |
| **Безопасность** | Проверка подписи Telegram, JWT, rate limiting, audit log |
| **Валидация** | class-validator на DTO, ValidationPipe |

---

## ❌ Что нужно сделать перед реальным запуском

### 1. База данных

- [ ] **PostgreSQL** — установлен и запущен (локально или облако).
- [ ] **Файл `.env`** в `backend/` — скопировать из `.env.example` и заполнить:
  ```env
  DATABASE_URL="postgresql://USER:PASSWORD@HOST:5432/DBNAME?schema=public"
  TELEGRAM_BOT_TOKEN="123456:ABC..."   # из @BotFather
  JWT_SECRET="случайная-строка-не-менее-32-символов"
  JWT_EXPIRES_IN="7d"
  PORT=3000
  NODE_ENV=production
  ```
- [ ] **Миграции** — один раз выполнить:
  ```bash
  cd backend && npx prisma migrate dev --name init
  ```

### 2. Telegram Bot и Mini App

- [ ] **Бот** создан в [@BotFather](https://t.me/BotFather), получен **TELEGRAM_BOT_TOKEN**.
- [ ] **Mini App** настроен: в BotFather или в меню бота указан URL фронтенда, например:
  - `https://ваш-домен.com/` (если фронт отдаётся с корня),
  - или `https://ваш-домен.com/miniapp/` (если в подпапке).
- [ ] Фронтенд открывается по **HTTPS** (Telegram требует HTTPS для Web App).

### 3. Подтверждение телефона (SMS)

- [ ] **Сейчас коды не отправляются** — в production они только пишутся в консоль (см. `backend/src/auth/auth.service.ts`, комментарий `TODO: отправить SMS`).
- [ ] Нужно подключить провайдера (SMS.ru, Twilio, и т.п.): в `requestPhoneCode` после сохранения кода в БД — вызвать API отправки SMS на `dto.phone` с текстом кода.

### 4. Бэкенд в продакшене

- [ ] **CORS** — в `backend/src/main.ts` стоит `app.enableCors({ origin: true })`. Для продакшена лучше явно указать домен фронта, например:
  ```ts
  app.enableCors({ origin: ['https://ваш-домен.com'] });
  ```
- [ ] **Хостинг** — развернуть backend (VPS, Railway, Render, и т.д.), чтобы был доступен по `https://api.ваш-домен.com` (или аналог).
- [ ] **Переменные** — на сервере задать все переменные из `.env` (не коммитить `.env` в git).

### 5. Фронтенд в продакшене

- [ ] **Сборка:** `cd frontend && npm run build` — выложить содержимое папки `dist/` на хостинг (Vercel, Netlify, свой сервер с nginx и т.д.).
- [ ] **URL API** — если API на другом домене, на странице перед загрузкой скриптов указать:
  ```html
  <script>window.APP_API_BASE = 'https://api.ваш-домен.com/api';</script>
  ```
  Либо настроить прокси на том же домене, чтобы запросы шли на `/api` и проксировались на бэкенд.

### 6. Дополнительно (рекомендуется)

- [ ] **Шифрование телефонов** — по ТЗ телефоны должны храниться в зашифрованном виде; сейчас в БД хранится обычная строка. При необходимости добавить шифрование при записи и расшифровку при чтении.
- [ ] **Логи и мониторинг** — настроить логирование ошибок и (по желанию) мониторинг (Sentry, и т.п.).
- [ ] **Резервные копии БД** — регулярный бэкап PostgreSQL.

---

## Итог

| Этап | Готовность |
|------|------------|
| Локальная разработка (с своей БД и тестовым ботом) | ✅ Можно запускать |
| Продакшен (реальные пользователи в Telegram) | ❌ Нужно: БД, .env, миграции, хостинг backend + frontend, HTTPS, бот, **отправка SMS**, при необходимости CORS и шифрование телефонов |

Минимальный набор для «реального» запуска: **PostgreSQL + .env + миграции + TELEGRAM_BOT_TOKEN + хостинг (backend + frontend по HTTPS) + настройка Mini App в боте**. Обязательно добавить отправку SMS, иначе пользователи не смогут подтвердить телефон.
